-- create database miniApartment
-- drop database miniApartment
use miniApartment;
CREATE TABLE role (
	id int auto_increment primary key,
    roleId INT unique,
    roleName VARCHAR(20)
);
CREATE INDEX role_id ON role(roleId);
create table contract(
	id bigint primary key auto_increment,
    contractId varchar(255) unique,
    roomId int,
    numberOfTenant int,
    rentalFee decimal,
    securityDeposite decimal,
    paymentCycle int,
    signinDate date,
    moveinDate date,
    expireDate date,
    contractStatus int,
	representative nvarchar(100)
);
-- CREATE INDEX contractId ON contract(contractId);
-- CREATE UNIQUE INDEX index_unique_column ON contract(contractId);
create table contractDetail(
	contractId varchar(255) primary key,
    totalArea decimal,
    landArea decimal,
    publicArea decimal,
    privateArea decimal,
    device nvarchar(255),
    ownerOrigin nvarchar(255),
    ownerLimit nvarchar(255),
	rights nvarchar(255),
    obligations nvarchar(255),
    commit nvarchar(255),
    copies int,
    relationship varchar(20),
     FOREIGN KEY (contractId) REFERENCES contract(contractId)
);
create table `tenants`(
	id bigint auto_increment primary key,
	email varchar(30) unique,
    roomId int,
    firstName NVARCHAR(15),
    lastName NVARCHAR(15),
    gender int,
    dateOfBirth DATE,
    contact VARCHAR(15),
    citizenId varchar(255),
    createCitizenIdDate Date,
    createCitizenIdPlace nvarchar(99),
    career varchar(25),
    licensePLate varchar(25),
    vehicleType varchar(20),
    vehicleColor varchar(20),
    residenceStatus varchar(20),
    contractId varchar(255),
    placeOfPermanet NVARCHAR(100),
    foreign key(contractId) references contract(contractId)
);
CREATE INDEX idex_role_id ON role(roleId);
CREATE INDEX idx_users_email ON tenants(email);
CREATE TABLE users (
	id bigint auto_increment primary key,
    userId VARCHAR(255),
    firstName NVARCHAR(15),
    lastName NVARCHAR(15),
    gender int,
    dateOfBirth DATE,
    placeOfPermanet NVARCHAR(100),
    email VARCHAR(30),
    contact VARCHAR(15),
    citizenId varchar(255),
    password VARCHAR(255),
    image varchar(255),
    roleId INT,
    FOREIGN KEY (roleId) REFERENCES Role(roleId),
    FOREIGN KEY (email) REFERENCES tenants(email)
);
create table token(
	id bigint auto_increment primary key,
	email VARCHAR(30),
    expriredToken Date,
    refreshToken varchar(255),
    FOREIGN KEY (email) REFERENCES users(email)
);
create table expensesDetail(
	paymentId bigint auto_increment primary key,
    roomId int,
	year year,
    month int,
    rentalFee decimal,
    electricity decimal,
    electricPreviousMeter double,
    electricCurrentMeter double,
    water decimal,
    waterPreviousMeter double,
    waterCurrentMeter double,
    internet decimal,
    service decimal,
    securityDeposite decimal,
    debt decimal,
    fine decimal,
    status varchar(20)
);
create table payment(
	id bigint primary key,
	roomId int,
	year year,
    month int,
    totalFee decimal,
    paid decimal,
    status varchar(20),
	foreign key (id) references expensesDetail(paymentId)
);
create table room(
	id bigint auto_increment primary key,
	roomId int unique,
	roomStatus enum('vacant','occupied', 'reserved'),
    maxTenant int
);

-- ALTER TABLE users ADD CONSTRAINT tenant_user FOREIGN KEY(email) REFERENCES tenants(email);
CREATE INDEX idex_room_id ON room(roomId);
ALTER TABLE payment ADD CONSTRAINT payment_ibfk_2 FOREIGN KEY(roomId) REFERENCES room(roomId);
CREATE INDEX room_id ON room (roomId);
ALTER TABLE contract ADD CONSTRAINT room_ibfk_1 FOREIGN KEY(roomId) REFERENCES room(roomId);
-- ALTER TABLE users ADD CONSTRAINT tenants_unique UNIQUE(email);
-- create table `token`(
-- 	email VARCHAR(255),
--     token varchar(255),
--     expTime datetime,
--
-- )
INSERT INTO miniapartment.`role`
(roleId,
roleName)
VALUES
(1,
'citizen');
INSERT INTO miniapartment.`role`
(roleId,
roleName)
VALUES
(2,
'admin');
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (101, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (102, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (103, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (104, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (105, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (106, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (107, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (108, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (109, 'vacant', 4);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (110, 'vacant', 4);

INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (201, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (202, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (203, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (204, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (205, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (206, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (207, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (208, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (209, 'vacant', 4);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (210, 'vacant', 4);

INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (301, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (302, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (303, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (304, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (305, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (306, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (307, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (308, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (309, 'vacant', 4);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (310, 'vacant', 4);

INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (401, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (402, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (403, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (404, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (405, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (406, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (407, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (408, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (409, 'vacant', 4);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (410, 'vacant', 4);

INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (501, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (502, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (503, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (504, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (505, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (506, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (507, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (508, 'vacant', 2);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (509, 'vacant', 4);
INSERT INTO room (roomId, roomStatus, maxTenant) VALUES (510, 'vacant', 4);


--
INSERT INTO miniapartment.`contract`
(contractId,`roomId`,`numberOfTenant`,`rentalFee`,`securityDeposite`,`paymentCycle`,`signinDate`,`moveinDate`,`expireDate`,`contractStatus`,`representative`)
VALUES
('1',101,1,'12000','122222',1,'2024-6-24','2024-6-26','2024-7-24',1,'tran tuan minh');

INSERT INTO miniapartment.`tenants`
(email,`roomId`,`firstName`,`lastName`,`gender`,`dateOfBirth`,`contact`,`citizenId`
,`career`,`licensePLate`,`vehicleType`,`vehicleColor`,`residenceStatus`,`contractId`)
VALUES
('minhtt14@fpt.com',101,'minh','tran tuan',1,'2003-12-24',0398707242,'024203123031',
'student','99AA-99999','wave','black','Failed',1);
INSERT INTO miniapartment.`tenants`
(email,`roomId`,`firstName`,`lastName`,`gender`,`dateOfBirth`,`contact`,`citizenId`
,`career`,`licensePLate`,`vehicleType`,`vehicleColor`,`residenceStatus`,`contractId`)
VALUES
('trantuanminhbg2003@gmail.com',101,'minh','tran tuan',1,'2003-12-24',0398707242,'024203123031',
'student','99AA-99999','wave','black','Failed',1);
INSERT INTO miniapartment.`tenants`
(email,`roomId`,`firstName`,`lastName`,`gender`,`dateOfBirth`,`contact`,`citizenId`
,`career`,`licensePLate`,`vehicleType`,`vehicleColor`,`residenceStatus`,`contractId`)
VALUES
('minhtthe173206@fpt.edu.vn',101,'minh','tran tuan',1,'2003-12-24',0398707242,'024203123031',
'student','99AA-99999','wave','black','Failed',1);